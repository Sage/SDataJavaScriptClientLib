<!DOCTYPE HTML>
<html>
<head>
    <title>SDataJavaScriptClientLib Test Runner</title>

    <script src="../libraries/dojo/dojo.js"></script>
    <script src="../libraries/dojo/DeferredList.js"></script>

    <link rel="stylesheet" type="text/css" href="../libraries/jasmine/jasmine.css">
    <script src="../libraries/jasmine/jasmine.js"></script>
    <script src="../libraries/jasmine/jasmine-html.js"></script>

    <!-- dependencies -->
    <script src="../libraries/sage/sage.js"></script>
    <script src="../libraries/sage/class.js"></script>
    <script src="../libraries/sage/event.js"></script>
    <script src="../libraries/sage/evented.js"></script>
    <script src="../libraries/sage/deferred.js"></script>
    <script src="../libraries/Base64.js"></script>
    <script src="../libraries/ObjTree.js"></script>
    <script src="../libraries/parseuri.js"></script>

    <!-- client -->
    <script src="../src/SDataAjax.js"></script>
    <script src="../src/SDataUri.js"></script>
    <script src="../src/SDataBaseRequest.js"></script>
    <script src="../src/SDataApplicationRequest.js"></script>
    <script src="../src/SDataSingleResourceRequest.js"></script>
    <script src="../src/SDataSystemRequest.js"></script>
    <script src="../src/SDataTemplateResourceRequest.js"></script>
    <script src="../src/SDataResourceCollectionRequest.js"></script>
    <script src="../src/SDataNamedQueryRequest.js"></script>
    <script src="../src/SDataResourcePropertyRequest.js"></script>
    <script src="../src/SDataServiceOperationRequest.js"></script>
    <script src="../src/SDataBatchRequest.js"></script>
    <script src="../src/SDataService.js"></script>

    <!-- test utility -->
    <script src="Utility.js"></script>

    <!-- tests -->
    <script src="SDataUriTests.js"></script>
    <script src="SDataServiceTests.js"></script>
    <script src="SDataSingleResourceRequestTests.js"></script>
    <script src="SDataResourceCollectionRequestTests.js"></script>
    <script src="SDataServiceOperationRequestTests.js"></script>
    <script src="SDataBatchRequestTests.js"></script>
</head>
<body>
<script>
    dojo.require('dojo.DeferredList');
    dojo.provide('Resources');
    dojo.mixin(Resources, {
        _store: {},
        get: function(name) {
            return Resources._store[name];
        },
        set: function(name, value) {
            Resources._store[name] = value;
        }
    });
    
    dojo.ready(function() {

        var wait = [],
            preload = [
                'TestEntry.xml',
                'TestEntryWithPrefix.xml',
                'TestEntryMixedPrefix.xml',
                'TestFeed.json', // if running this test through IIS, be sure to have the appropriate mime type, 'application/json', set for '.json'.
                'TestFeed.xml',
                'TestFeedExplicit.xml',
                'TestFeedSplit.xml',
                'TestFeedWithPrefix.xml',
                'TestServiceResponse.xml'
            ];

        dojo.forEach(preload, function(item) {
            wait.push(dojo.xhrGet({
                url: item,
                handleAs: 'text'
            }).then(function(result) {
                Resources.set(item, result);
            }));
        });

        new dojo.DeferredList(wait)
            .then(function(results) {
                if (dojo.some(results, function(result) { return !result[0]; }))
                    throw new Error("Could not pre-load expected resources.");

                jasmine.getEnv().addReporter(new jasmine.TrivialReporter());
                jasmine.getEnv().execute();
            });
    });
</script>
</body>
</html>
